<!doctype html><html lang=en-us><head><meta charset=utf-8><meta charset=utf-8><meta name=description content="MayJuun: Less Clicking, More Doctoring"><meta name=author content="MayJuun"><meta name=generator content="Hugo 0.83.1"><meta name=format-detection content="telephone=no"><meta name=viewport content="width=device-width,initial-scale=1"><title>Flutter Servers</title><link rel=icon href=https://mayjuun.com/images/favicon.ico><link rel=stylesheet href=https://mayjuun.com/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://mayjuun.com/plugins/ionicons/ionicons.min.css><link rel=stylesheet href=https://mayjuun.com/plugins/animate-css/animate.css><link rel=stylesheet href=https://mayjuun.com/plugins/slider/slider.css><link rel=stylesheet href=https://mayjuun.com/plugins/slick/slick.css><link rel=stylesheet href=https://mayjuun.com/plugins/facncybox/jquery.fancybox.css><link rel=stylesheet href=https://mayjuun.com/plugins/hover/hover-min.css><link rel=stylesheet href=https://mayjuun.com/css/style.min.css integrity media=screen></head><body><section class="top-bar animated-header"><div class=container><div class=row><div class=col-lg-12><nav class="navbar navbar-expand-md navbar-light bg-light"><a class=navbar-brand href=https://mayjuun.com/><img src=https://mayjuun.com/images/logo.png alt=logo></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://mayjuun.com/>Home</a></li><li class=nav-item><a class=nav-link href=https://mayjuun.com/blog>Meta-Blog</a></li><li class=nav-item><a class=nav-link href=https://mayjuun.com/fhirfli>FHIR-FLI</a></li><li class=nav-item><a class=nav-link href=https://mayjuun.com/portfolio>Flutter Portfolio</a></li><li class=nav-item><a class=nav-link href=https://mayjuun.com/gallery>Figma Gallery</a></li><li class=nav-item><a class=nav-link href=https://mayjuun.com/about>About</a></li><li class=nav-item><a class=nav-link href=https://mayjuun.com/service>Services</a></li><li class=nav-item><a class=nav-link href=https://mayjuun.com/contact>Contact</a></li></div></nav></div></div></div></section><section class=global-page-header><div class=container><div class=row><div class=col-md-12><div class=block><h2>Flutter Servers</h2><div class=portfolio-meta><span>Sunday, May 16, 2021</span>|
<span>Tags:
Flutter, Dart, Server, WebApp, Google Cloud, Docker</span></div></div></div></div></div></section><section class=single-post><div class=container><div class=row><div class=col-md-12><div class=post-content><h2 id=this-is-a-reproduction-of-the-readme-from-the-repo-herehttpsgithubcommayjuunservers>This is a reproduction of the readme from the <a href=https://github.com/MayJuun/servers>repo here</a>.</h2><p>Have you ever wanted to try and host your Flutter web app but weren&rsquo;t sure how to do it? I like Dart and Flutter, and didn&rsquo;t want to have to learn another language just to have a web server. Luckily, there are a couple of packages that already have this functionality. I&rsquo;ve just detailed how they work, and how they can be placed in a docker container for easy deployment (including on Google Cloud!)</p><h2 id=quick-shout-outs-to-the-following-people-for-making-my-life-much-easier-for-this>Quick shout outs to the following people for making my life much easier for this:</h2><ul><li><a href="https://www.youtube.com/watch?v=y6Z1V8QpGFc">Jermaine Oppong YouTube Tutorial</a></li><li><a href="https://www.youtube.com/watch?v=SIDOSAdevWM">Nick Manning YouTube Tutorial</a></li><li><a href=https://medium.com/google-cloud/build-slim-docker-images-for-dart-apps-ee98ea1d1cf7>Tony Pujals - Google Engineer</a></li></ul><h2 id=get-server>Get Server</h2><p>This uses the <a href=https://pub.dev/packages/get_server>get_server</a> package.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=color:#66d9ef>void</span> main() <span style=color:#f92672>=&gt;</span> runApp(
      GetServer(
        home: FolderWidget(<span style=color:#e6db74>&#39;app/web&#39;</span>),
        getPages: [
          GetPage(
            name: <span style=color:#e6db74>&#39;/&#39;</span>,
            page: () <span style=color:#f92672>=&gt;</span> Html(path: <span style=color:#e6db74>&#39;app/web/index.html&#39;</span>),
          ),
          GetPage(
            name: <span style=color:#e6db74>&#39;/redirect&#39;</span>,
            page: () <span style=color:#f92672>=&gt;</span> Html(path: <span style=color:#e6db74>&#39;app/web/index.html&#39;</span>),
          ),
        ],
        onNotFound: Html(path: <span style=color:#e6db74>&#39;app/web/index.html&#39;</span>),
      ),
    );
</code></pre></div><ul><li>Note that the <code>home</code> argument is required (it tells the server where to look for the web folder). The <code>GetPage</code> and <code>onNotFound</code> specify a path to a webpage (which for us is all the same).</li></ul><h2 id=shelf-server>Shelf Server</h2><p>This uses primarily <a href=https://pub.dev/packages/shelf>shelf</a> but also <a href=https://github.com/GoogleCloudPlatform/functions-framework-dart>functions_framework</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart>Future<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> main(List<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>String</span><span style=color:#f92672>&gt;</span> args) <span style=color:#66d9ef>async</span> {
  <span style=color:#66d9ef>await</span> serve(args, _nameToFunctionTarget);
}

FunctionTarget<span style=color:#f92672>?</span> _nameToFunctionTarget(<span style=color:#66d9ef>String</span> name) {
  <span style=color:#66d9ef>switch</span> (name) {
    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;function&#39;</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>return</span> FunctionTarget.http(
        createStaticHandler(<span style=color:#e6db74>&#39;app/web&#39;</span>, defaultDocument: <span style=color:#e6db74>&#39;index.html&#39;</span>),
      );
    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
  }
}
</code></pre></div><h2 id=directory>Directory</h2><ul><li>It is important to pay attention to the path for both of these servers. We specify <code>app/web</code> because this is the directory in the Docker container. If you want to run this directly without Docker, you need to change it to simply <code>web</code>.</li></ul><h2 id=flutter-project>Flutter Project</h2><ul><li>Remember, these simple servers are designed solely to host your Flutter web project. They both use the same setup, including the same Docker file.</li></ul><h2 id=docker---how-to-setup-the-docker-container>Docker - how to setup the docker container</h2><ol><li>Ensure docker is installed, to check run:<br><code>$ docker run hello-world</code></li><li>Take a flutter project that&rsquo;s ready for web deployment</li><li>In the root of that directory, run<br><code>$ flutter build web</code></li><li>Copy the contents of folder <code>build/web</code> (NOT the web folder - that would be too obvious) to the folder <code>web</code> in the server - currently they just hold an example of the startup app</li><li>Paste the contents into the <code>web</code> folder (overwrite what is there now, although if you want to use the workflow of having OAuth done in an external window, I&rsquo;ve kept the redirect.html file in the web folder that you may use, read more about <a href=https://itnext.io/flutter-web-oauth-authentication-through-external-window-d890a7ff6463>that here</a>)</li><li>From the root of the server project, run the following:<br><code>$ docker build -t projectName .</code></li><li>Test it:<br><code>$ docker run -d -p 8080:8080 projectName</code></li></ol><h2 id=google-cloud>Google Cloud</h2><ol><li><p>Get Google Cloud account</p></li><li><p>Create Project</p></li><li><p>Note Project ID</p></li><li><p>Enable Container Registry & Cloud Run APIs</p></li><li><p>Initialize gcloud<br><code>$ gcloud init</code></p></li><li><p>Configure docker for gcloud<br><code>$ gcloud auth configure-docker</code></p></li><li><p>Build container in Google Cloud Container Registry<br><code>$ docker build -t gcr.io/projectId/projectName:version .</code></p></li><li><p>For the above, the projectId is your GCP project ID, the projectName is the name of the docker file that we had above, and the version is however you want to define versions in the cloud so in the future you&rsquo;ll know which is which. For instance, if our GCP project Id is <code>new-project-123456</code> our docker project was called <code>docker-project</code>, we would write:<br><code>$ docker build -t gcr.io/new-project-123456/docker-project:v0.1 .</code></p></li><li><p>Push container to cloud<br><code>$ docker push gcr.io/projectId/projectNam:version</code></p></li><li><p>If you go to your GCP console and open the Container Registry, you should see the container that you just pushed</p></li><li><p>Open Cloud Run in your GCP Console</p></li><li><p>Create Service, choose your service name, and pick your Region</p></li><li><p>Select <code>Deploy one revision from an existing container image</code>, and choose the image you just uploaded</p></li><li><p>Click on Advanced Settings, and under Capacity, change the Memory allocated to <code>1 GiB</code></p></li><li><p>For testing purposes</p></li></ol><ul><li>Ingress: Allow all traffic</li><li>Authentication: Allow unauthenticated invocations</li></ul><ol start=16><li>Create!</li><li>When finished, you will see a URL that will now be hosting your flutter web app</li></ol></div></div></div></div></section><section id=call-to-action><div class=container><div class=row><div class=col-md-12><div class=block><h2 class="title wow fadeInDown" data-wow-delay=.3s data-wow-duration=500ms>Want to Learn More?</h1><a href=/contact class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=.7s data-wow-duration=500ms>Contact Us</a></div></div></div></div></section><footer id=footer><div class=container><div class="row content-justify-between"><p class=copyright>Website Content: Copyright
<span><script>document.write((new Date).getFullYear())</script></span>by MayJuun. Contact us: <a href=mailto:info@mayjuun.com>info@mayjuun.com</a><br>Website Theme: Copyright 2020. Original design by <a href=http://www.themefisher.com target=_blank>Themefisher</a> under <a href=https://github.com/themefisher/timer-hugo/blob/master/LICENSE target=_blank>MIT license</a>, modified by MayJuun<br>FHIR® is a registered trademark of Health Level Seven International (HL7) and its use does not constitute an endorsement of products by HL7®</p></div></div></footer><script src=https://mayjuun.com/plugins/jQurey/jquery.min.js></script><script src=https://mayjuun.com/plugins/form-validation/jquery.form.js></script><script src=https://mayjuun.com/plugins/form-validation/jquery.validate.min.js></script><script src=https://mayjuun.com/plugins/slick/slick.min.js></script><script src=https://mayjuun.com/plugins/bootstrap/bootstrap.min.js></script><script src=https://mayjuun.com/plugins/wow-js/wow.min.js></script><script src=https://mayjuun.com/plugins/slider/slider.js></script><script src=https://mayjuun.com/plugins/facncybox/jquery.fancybox.js></script><script src=https://mayjuun.com/js/script.min.js></script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-50100304-2','auto'),ga('send','pageview')</script></body></html>